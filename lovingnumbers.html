<!DOCTYPE html>
<html>
<head>
  <title>Verliebte Zahlen finden</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <meta charset="UTF-8" />
  <style>
    body {
      margin: 0;
      height: 100vh;
      width: 100vw;
      background-color: #222;
      overflow: hidden;
      font-family: sans-serif;
      color: #DDD;
    }
    #menu, #result {
        width: 76vw;
        margin: 5vh 10vw;
        padding: 2vh 2vw;
        background-color: purple;
        border-radius: 40px;
        font-size: 12pt;
    }
    #result h1,
    #result p,
    #menu h1,
    #menu div,
    #menu p {
        text-align: center;
        margin-bottom: 1em;
    }
    #menu button,
    #result button {
        background-color: #DDD;
        color: #222;
        border: 0px;
        padding: 0.5em;
        margin: 0.5em;
        border-radius: 20px;
        font-size: 150%;
        width: calc(100% - 1em);
    }
    #score {
        position: absolute;
        top: 0px;
        left: 0px;
        width: 100vw;
        padding: 9px 0;
        background-color: purple;
        font-size: 54px;
        text-align: center;
    }
    #heart {
        position: absolute;
        width: 200px;
        height: 200px;
        background-color: red;
        clip-path: path('M100 30 C 100 0, 0 0, 0 60 C 0 120, 100 170, 100 200 C 100 170, 200 120, 200 60 C 200 0, 100 0, 100 30 Z');
        display: flex;
        align-items: center;
        justify-content: center;
        color: #DDD;
        font-size: 72pt;
        transition: background-color 0.5s, box-shadow 0.5s, transform 0.5s;
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
    }
    #numbers {
        position: absolute;
        bottom: 0px;
        width: 80vw;
        height: 240px;
        margin: 10px 10vw;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
    }

    #numbers button {
        background-color: purple;
        color: #DDD;
        border: 0px;
        margin: 2px;
        border-radius: 20px;
        font-size: 250%;
    }

  </style>
</head>
<body>
  <div id="menu">
    <h1>VERLIEBTE ZAHLEN</h1>
    <p>
        Wähle Deine Zeit, um verliebte Zahlen zu finden.
        Liegst Du richtig, bekommst Du einen Punkt.
        Aber Achtung: Liegst Du falsch, wird Dir ein Punkt abgezogen.
        Beim Endlosmodus endet das Spiel bei der ersten falschen Zahl.
    </p>
    <div id="startButton">
        <button data-value="30">30 Sekunden</button>
        <button data-value="60">1 Minute</button>
        <button data-value="120">2 Minuten</button>
        <button data-value="0">Endlosmodus</button>
    </div>
  </div>
  <div id="game" style="display: none;">
    <div id="score"># 0 #</div>
    <div id="heart">5</div>
    <div id="numbers">
        <button data-value="1">1</button>
        <button data-value="2">2</button>
        <button data-value="3">3</button>
        <button data-value="4">4</button>
        <button data-value="5">5</button>
        <button data-value="6">6</button>
        <button data-value="7">7</button>
        <button data-value="8">8</button>
        <button data-value="9">9</button>
    </div>
  </div>
  <div id="result" style="display: none;">
      <h1>GAME OVER</h1>
      <p id="klasse">---</p>
      <h2>Modus: <span id="modus">0</span></h2>
      <h2>Punkte: <span id="endstand">0</span></h2>
      <button id="endButton">Zum Menü</button>
  </div>
  <script>
    const menu = document.getElementById('menu');
    const result = document.getElementById('result');
    const startButton = document.getElementById('startButton');
    const game = document.getElementById('game');
    const heart = document.getElementById('heart');
    const scoreDiv = document.getElementById('score');

    let currentNumber = null;
    let score = 0;
    let duration = 0;

    function moveHeart() {
        const x = Math.random() * (window.innerWidth - 200);
        const y = Math.max(Math.random() * (window.innerHeight - 530) + 80, 80);
        heart.style.left = `${x}px`;
        heart.style.top = `${y}px`;
    }

    function updateHeartNumber() {
        currentNumber = Math.floor(Math.random() * 9) + 1;
        heart.textContent = currentNumber;
    }

    function emptyHeartNumber() {
        currentNumber = null;
        heart.textContent = currentNumber;
    }

    function updateScoreDisplay() {
        scoreDiv.textContent = `# ${score} #`;
    }

    /* GameLogic */
    function handleGuess(guess) {
        let timeout = 500;

        if (guess === null || currentNumber === null) {
            return; // cancelled
        }

        const guessedNumber = parseInt(guess);

        if (isNaN(guessedNumber)) {
            return;
        }

        if (guessedNumber + currentNumber === 10) {
            score++;
            heart.style.backgroundColor = "gold";
        } else {
            if (duration === 0) {
                handleEnd();
            } else {
                score--;
                heart.style.backgroundColor = "black";
                timeout = 1000;
            }
        }

        updateScoreDisplay();
        emptyHeartNumber();

        setTimeout(() => {
            heart.style.backgroundColor = "red";
            moveHeart();
            updateHeartNumber();
        }, timeout);
    }

    /* EventHandler */
    function handleAgain() {
        menu.style.display = "block";
        game.style.display = "none";
        result.style.display = "none";
    }

    function handleEnd() {
        menu.style.display = "none";
        game.style.display = "none";
        result.style.display = "block";

        let motivation = ""
        if (duration === 0) {
            motivation = "Der Wille kennt keine Grenze. Konzentrieren und weiterspielen!";
        } else {
            let klasse = score / duration;
            if (klasse > 0.8) {
                motivation = "Eine unvorstellbare Punktezahl - Genial!";
            } else if (klasse > 0.6) {
                motivation = "Das ist eine beeindruckende Punktezahl - Weiter so!";
            } else if (klasse > 0.4) {
                motivation = "Ein gutes Ergebnis - Schaffst Du mehr?";
            } else if (klasse > 0.2) {
                motivation = "Gut Gespielt! Du musst nur schneller werden!";
            } else if (klasse > 0) {
                motivation = "Du bist auf einem guten Weg.";
            } else {
                motivation = "Ich glaube Du hast geraten. Das kannst Du sicherlich besser!";
            }
        }

        document.getElementById('klasse').innerHTML = motivation;
        document.getElementById('modus').innerHTML = {
            0: "Endlosmodus",
            30: "30 Sekunden",
            60: "1 Minute",
            120: "2 Minuten"
        }[duration];
        document.getElementById('endstand').innerHTML = score;
    }

    function handleStart(sec) {
        score = 0;
        duration = parseInt(sec);
        menu.style.display = "none";
        game.style.display = "block";
        result.style.display = "none";
      
        updateScoreDisplay();
        moveHeart();
        updateHeartNumber();

        if (duration > 0) {
            setTimeout(handleEnd, duration * 1000);
        }
    }

    function handleKeyPress(event) {
        handleGuess(event.key);
    }

    /* Events */
    document.body.addEventListener('keypress', handleKeyPress);
    document.getElementById("endButton").addEventListener('click', handleAgain)

    const starts = document.querySelectorAll('#startButton button');
    starts.forEach(button => {
        button.addEventListener('click', function() {
            handleStart(this.getAttribute('data-value'));
        });
    });

    const buttons = document.querySelectorAll('#numbers button');
    buttons.forEach(button => {
        button.addEventListener('click', function() {
            handleGuess(this.getAttribute('data-value'));
        });
    });
  </script>
</body>
</html>
